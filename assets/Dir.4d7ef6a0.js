import{m as F}from"./marked.esm.fa6ab4f4.js";import{d as L,r as x,w as j,o as M,j as u,k as g,V as T,g as $,u as O,c as w,a as P,h as V,q as c,p as z,v as A,l as E,i,B as W,t as k,y as C,F as R,W as q}from"./vendor.eb580b82.js";import{a as H,g as B,b as N,u as S,c as D,e as G,r as I,s as U,f as b}from"./index.26b23a9a.js";const J=L({props:{src:{default:""},size:{default:248}},setup(y){const n=y,r=x(null),p=()=>{const{src:m,size:o}=n;if(!m)return;const t=r.value;if(!t)return;const e=t.getContext("2d");if(!e)return;const s=new Image;s.onload=()=>{const{naturalHeight:a,naturalWidth:l}=s;l===a?(t.height=o,t.width=o):l>a?(t.height=o,t.width=o*(l/a)):l<a&&(t.width=o,t.height=o*(a/l)),e.drawImage(s,0,0,t.width,t.height)},s.decoding="async",s.src=m};return j(()=>n.src,p),M(()=>p()),(m,o)=>(u(),g("canvas",{class:"aspect-square object-cover",ref_key:"canvasEl",ref:r},null,512))}}),K={class:"flex aspect-square overflow-hidden rounded bg-black/25"},Q=["textContent","title"],X=L({props:{entry:null},setup(y){const n=y,r=x(""),p=x(!1),m=x(!1),o=x(null);T(o,([{isIntersecting:d}])=>{p.value=d,d&&!m.value&&(m.value=!0,n.entry.type==="image"?t(n.entry.file):e())});const t=d=>{r.value=URL.createObjectURL(d)},e=async()=>{if(!n.entry.isDir)return;const d=await H(n.entry.handle),f=B(d,n.entry.handle.name);if(f!=null&&f.isFile)return t(f.file);const _=N(d);if(_!=null&&_.isFile)return t(_.file)};$(()=>{r.value.startsWith("blob:")&&URL.revokeObjectURL(r.value)});const s=O(),a=w(()=>{const{name:d}=n.entry.handle,{path:f}=s.params;return encodeURIComponent(f?decodeURIComponent(f)+"/"+d:d)}),l=P(),v=async()=>{if(n.entry.isDir){l.push({name:"Files",params:{path:a.value}});return}n.entry.isActive=!0},h=w(()=>{switch(n.entry.type){case"audio":return"Music1";case"dir":return"Folder";case"image":return"MediaImage";case"markdown":return"TextAlt";case"pdf":return"JournalPage";case"text":return"Page";case"unknown":return"EmptyPage";case"video":return"MediaVideo";default:return"EmptyPage"}});return(d,f)=>{const _=V("app-icon");return u(),g("button",{ref_key:"refWrap",ref:o,class:"group flex flex-col items-stretch gap-1 text-left",onClick:v},[c("div",K,[m.value&&r.value?z((u(),E(J,{key:0,src:r.value},null,8,["src"])),[[A,p.value]]):(u(),E(_,{key:1,name:i(h),size:"48",class:"mx-auto self-center text-gray-700"},null,8,["name"]))]),c("div",{class:"truncate rounded bg-gray-800 p-2 text-sm leading-none text-gray-500 group-hover:bg-gray-700/50",textContent:W(y.entry.handle.name),title:y.entry.handle.name},null,8,Q)],512)}}}),Y={class:"sticky top-0 flex items-center justify-between bg-black/75 px-4 py-2 text-gray-400 backdrop-blur"},Z=["textContent"],ee={class:"flex gap-4"},te={key:0,class:"animate-spin"},ne={key:0,class:"grid grow place-content-center"},se={class:"space-y-2 text-center text-gray-600"},ae=c("div",{class:"text-xl uppercase"},"Empty",-1),re={key:0,class:"mx-auto w-full max-w-screen-2xl p-4"},oe={class:"flex gap-4 rounded bg-gray-800 p-8 shadow-lg"},ce=["innerHTML"],le={key:0},ie=["src","alt"],ue={class:"mx-auto grid w-full max-w-screen-2xl grid-cols-5 gap-4 p-4"},ge=L({setup(y){S();const n=w(()=>b.value.find(e=>e.type==="markdown"&&e.file.name.toLowerCase()==="readme.md")),r=x(""),p=new F.Renderer,m=p.link;p.link=(e,s,a)=>{const l=e==null?void 0:e.startsWith(`${location.protocol}//${location.hostname}`),v=m.call(p,e,s,a);return l?v:v.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},j(n,async e=>{if(!e||!e.isFile){r.value="";return}r.value=F.parse(await e.file.text(),{headerIds:!1,renderer:p})});const o=w(()=>{var e;return B(b.value,((e=D.value)==null?void 0:e.name)||"")}),t=w(()=>{var e;return((e=o.value)==null?void 0:e.isFile)&&URL.createObjectURL(o.value.file)});return(e,s)=>{var l,v;const a=V("app-icon");return u(),g(R,null,[c("header",Y,[c("div",{textContent:W((l=i(D))==null?void 0:l.name)},null,8,Z),c("div",ee,[i(G)?(u(),g("div",te,[k(a,{class:"-scale-x-100",name:"AirplaneRotation"})])):C("",!0),c("button",{onClick:s[0]||(s[0]=(...h)=>i(I)&&i(I)(...h))},[k(a,{name:"Refresh"})]),c("button",{onClick:s[1]||(s[1]=(...h)=>i(U)&&i(U)(...h))},[k(a,{name:"Folder"})])])]),i(b).length?(u(),g(R,{key:1},[r.value?(u(),g("div",re,[c("div",oe,[c("div",{class:"prose prose-sm prose-invert max-w-none flex-grow prose-headings:text-teal-100 prose-a:text-teal-600 prose-pre:bg-black prose-img:rounded",innerHTML:r.value},null,8,ce),i(t)?(u(),g("div",le,[c("img",{src:i(t),alt:(v=i(D))==null?void 0:v.name,class:"h-64 w-64 rounded object-cover shadow"},null,8,ie)])):C("",!0)])])):C("",!0),c("div",ue,[(u(!0),g(R,null,q(i(b),h=>(u(),E(X,{key:h.handle.name,entry:h},null,8,["entry"]))),128))])],64)):(u(),g("div",ne,[c("div",se,[k(a,{class:"mx-auto",name:"GlassEmpty",size:"96"}),ae])]))],64)}}});export{ge as default};
